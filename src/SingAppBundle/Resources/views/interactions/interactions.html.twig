{% extends '@SingApp/layouts/base.html.twig' %}

{% block body %}
    {% if is_granted('ROLE_USER') %}
        <div class="products">
        {% include '@SingApp/layouts/navigation.html.twig' %}
        <div class="message">
            <div class="col-xs-12 col-sm-12 col-md-12 listing-content-main">
                <div class="col-xs-12 col-sm-12 col-md-12 interaction-category mrb30">
                    {#<div class="col-xs-6 col-sm-3 col-md-3 category-item padding-5">#}
                    {#<a>#}
                    {#<div class="category total-interactions active" data-mh="category"#}
                    {#data-count-type="all_reviews">#}
                    {#<div class="status">#}
                    {#<h1>24</h1>#}
                    {#<h3>Total Interactions</h3>#}
                    {#</div>#}
                    {#</div>#}
                    {#</a>#}
                    {#</div>#}
                    {#<div class="col-xs-6 col-sm-3 col-md-3 category-item padding-5">#}
                    {#<a>#}
                    {#<div class="category new-interactions" data-mh="category" data-count-type="new_reviews">#}
                    {#<div class="status">#}
                    {#<h1>4</h1>#}
                    {#<h3>New Interactions</h3>#}
                    {#</div>#}
                    {#</div>#}
                    {#</a>#}
                    {#</div>#}
                    {#<div class="col-xs-6 col-sm-3 col-md-3 category-item padding-5">#}
                    {#<a>#}
                    {#<div class="category positive-interactions" data-mh="category"#}
                    {#data-count-type="positive_reviews">#}
                    {#<div class="status">#}
                    {#<h1>15</h1>#}
                    {#<h3>Positive Interactions</h3>#}
                    {#</div>#}
                    {#</div>#}
                    {#</a>#}
                    {#</div>#}
                    {#<div class="col-xs-6 col-sm-3 col-md-3 category-item padding-5">#}
                    {#<a>#}
                    {#<div class="category negative-interactions" data-mh="category"#}
                    {#data-count-type="negative_reviews">#}
                    {#<div class="status">#}
                    {#<h1>0</h1>#}
                    {#<h3>Negative Interactions</h3>#}
                    {#</div>#}
                    {#</div>#}
                    {#</a>#}
                    {#</div>#}
                    {#</div>#}
                    {#<div class="col-xs-12 col-sm-12 col-md-12 filter-row">#}
                    {#<div class="col-sm-4 col-md-2 filter-header">#}
                    {#Time#}
                    {#</div>#}
                    {#<div class="col-sm-4 col-sm-offset-4 col-md-3 col-md-offset-7 filter-header">#}
                    {#Review Site#}
                    {#</div>#}
                    {#<div class="col-sm-4 col-md-2 controls control-group float-left">#}
                    {#<select id="time-filter" class="pull-left form-control">#}
                    {#<option value="0"> Until Today</option>#}
                    {#<option value="1"> Past 1 day</option>#}
                    {#<option value="7"> Past 7 days</option>#}
                    {#<option value="14"> Past 14 days</option>#}
                    {#<option value="30"> Past month</option>#}
                    {#<option value="between"> Custom Range</option>#}
                    {#</select>#}
                    {#</div>#}
                    {#<div class="col-sm-4 col-md-6 controls">#}
                    {#<div id="date-filter" class="control-group col-md-5">#}
                    {#<input type="text" placeholder="From Date" data-provide="datepicker"#}
                    {#class="date-filter-input form-control" id="start-date-filter">#}
                    {#</div>#}
                    {#<div class="col-md-1">#}
                    {#<span style="font-size: 19px;">and</span>#}
                    {#</div>#}
                    {#<div class="control-group col-md-5">#}
                    {#<input type="text" placeholder="To Date" data-provide="datepicker"#}
                    {#data-date-end-date="0d" class="date-filter-input form-control" id="end-date-filter">#}
                    {#</div>#}
                    {#</div>#}
                    {#<div class="col-sm-4 col-md-3 col-md-offset-1 controls control-group float-right"#}
                    {#id="styled-site-filter">#}
                    {#<select class="pull-left form-control" id="site-filter" data-changed="false">#}
                    {#<option value="all">All (24)</option>#}
                    {#<option>Facebook (20)</option>#}
                    {#<option>Google Maps (4)</option>#}
                    {#</select>#}
                    {#</div>#}

                    {#</div>#}

                    <div id="interactions-view">
                    {% for review in googleReviews %}
                        <div class="col-xs-12 col-sm-12 col-md-12 interaction-item no-padding mrb30"
                             data-review-id="17914383">
                            <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-head">
                                <div class="interaction-img">
                                    <figure>
                                        <img src="/images/listing-icons/google.com.png" alt="">
                                    </figure>
                                </div>
                                <div class="col-xs-6 col-sm-7 col-md-7 head-left left6p5percent">
                                    {{ review.reviewer.displayName }}
                                    <span>
                                    added a new comment
                                    on {{ review.createTime|date('Y-m-d H:i:s') }} UTC
                                    </span>
                                </div>
                                <div class="col-xs-6 col-sm-5 col-md-3 head-right pull-right">
                                    <div class="response-width">
                                        {% if review.reviewReply is defined and review.reviewReply is not empty %}
                                            <div class="response replied">Responded</div>
                                        {% else %}
                                            <div class="response disable">Response Pending</div>
                                        {% endif %}
                                    </div>
                                    <div class="rating">
                                        {% if review.starRating == 'FIVE' %}
                                            <span class="float-right"><i
                                                        class="text-warning fa fa-star"></i></span>
                                            <span class="float-right"><i
                                                        class="text-warning fa fa-star"></i></span>
                                            <span class="float-right"><i
                                                        class="text-warning fa fa-star"></i></span>
                                            <span class="float-right"><i
                                                        class="text-warning fa fa-star"></i></span>
                                            <span class="float-right"><i
                                                        class="text-warning fa fa-star"></i></span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-content">
                                <div class="col-md-12 no-padding">
                                    <h3></h3>
                                    <p>{{ review.comment }}</p>
                                </div>
                                {% if review.reviewReply is defined and review.reviewReply is not empty %}
                                    <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment no-padding mrt20">
                                        <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment-head">
                                            <p>Comment
                                                on {{ review.reviewReply.updateTime|date('Y-m-d H:i:s') }} UTC
                                                from <span>Owner</span>
                                            </p>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment-content">
                                            <p>{{ review.reviewReply.comment }}</p>
                                        </div>
                                    </div>

                                {% endif %}
                            </div>
                            {% if review.reviewReply is not defined or review.reviewReply is empty %}
                                <div class="col-xs-12 col-sm-12 col-md-12" style="margin-bottom: 15px;">
                                    <button class="btn btn-primary btn-response">Respond</button>

                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-12 review-response-form" style="display: none">
                                    <form class="simple_form new_review_submission" id="new_review_submission" action="{{ url('google-reviews-reply', app.request.query.all) }}" method="post">
                                        <div class="alert alert-danger alert-dismissible collapse" role="alert">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">×</span></button>
                                            <strong>Error! </strong><p> Please correct the errors before submitting</p>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 controls no-padding-left">
                                            <textarea label="false" autofocus="autofocus" placeholder="Enter review response" cols="150" rows="3" required="required" class="response-content form-control" name="text" id="review_submission_content"></textarea>
                                        </div>
                                         <input type="hidden" name="reviewId" value="{{ review.name }}">
                                        <div class="col-xs-12 col-sm-12 col-md-3 col-md-offset-9 response-btn-row">
                                            <input type="submit" name="commit" value="Submit" class="btn btn-primary pull-right response-submit-btn">
                                            <a class="response-close-btn">Close</a>
                                        </div>
                                    </form>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    {% for mediaId, comments in instagramServices.comments %}
                        {% if comments is not empty %}
                            {% for comment in comments %}
                                <div class="col-xs-12 col-sm-12 col-md-12 interaction-item no-padding mrb30"
                                     data-review-id="17914383">
                                    <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-head">
                                        <div class="interaction-img">
                                            <figure>
                                                <img src="/images/listing-icons/instagrame.com.png" alt="">
                                            </figure>
                                        </div>
                                        <div class="col-xs-6 col-sm-7 col-md-7 head-left left6p5percent">
                                            {{ comment.getUser().getUsername() }}
                                            <span>
                                            added a new comment
                                            on {{ comment.getCreatedAt()|date('Y-m-d H:i:s') }} UTC
                                            </span>
                                        </div>
                                        <div class="col-xs-6 col-sm-5 col-md-3 head-right pull-right">
                                            <div class="response-width">
                                                {% if getCommentsReplies(mediaId, comment.getPk())|length > 0 %}
                                                    <div class="response replied">Responded</div>
                                                {% else %}
                                                    <div class="response disable">Response Pending</div>
                                                {% endif %}
                                            </div>
                                            <div class="rating"></div>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-content">
                                        <div class="col-md-12 no-padding">
                                            <h3></h3>
                                            <p>{{ comment.getText() }}</p>
                                        </div>
                                        {% for commentReplies in getCommentsReplies(mediaId, comment.getPk()) %}
                                            <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment no-padding mrt20">
                                                <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment-head">
                                                    <p>Comment
                                                        on {{ commentReplies.getCreatedAt()|date('Y-m-d H:i:s') }} UTC
                                                        from <span>{{ commentReplies.getUser().getUsername() }}</span>
                                                    </p>
                                                </div>
                                                <div class="col-xs-12 col-sm-12 col-md-12 interaction-comment-content">
                                                    <p>{{ commentReplies.getText() }}</p>
                                                </div>
                                            </div>

                                        {% endfor %}
                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-12" style="margin-bottom: 15px;">
                                        <button class="btn btn-primary btn-response">Respond</button>

                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-12 review-response-form" style="display: none">
                                    {% set params = app.request.query.all|merge({ 'mediaId': mediaId, 'comment': comment.getPk() }) %}
                                        <form class="simple_form new_review_submission" id="new_review_submission" action="{{ url('interactions-comment-add', params) }}" method="post">
                                            <div class="alert alert-danger alert-dismissible collapse" role="alert">
                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                    <span aria-hidden="true">×</span></button>
                                                <strong>Error! </strong><p> Please correct the errors before submitting</p>
                                            </div>
                                            <div class="col-xs-12 col-sm-12 col-md-12 controls no-padding-left">
                                                <textarea label="false" autofocus="autofocus" placeholder="Enter review response" cols="150" rows="3" required="required" class="response-content form-control" name="text" id="review_submission_content"></textarea>
                                            </div>

                                            <div class="col-xs-12 col-sm-12 col-md-3 col-md-offset-9 response-btn-row">
                                                <input type="submit" name="commit" value="Submit" class="btn btn-primary pull-right response-submit-btn">
                                                <a class="response-close-btn">Close</a>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}

                        {% endfor %}


                        <div class="col-xs-12 col-sm-12 col-md-12 interaction-item no-padding mrb30"
                             data-review-id="17331865">
                            <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-head">
                                <div class="interaction-img">
                                    <figure>
                                        <img src="/images/listing-icons/instagrame.com.png" alt="">
                                    </figure>
                                </div>
                                <div class="col-xs-6 col-sm-7 col-md-7 head-left left6p5percent">
                              <span>
                                  You have {{ instagramServices.likes }} new likes
                              </span>
                                </div>
                                <div class="col-xs-6 col-sm-5 col-md-5 head-right pull-right">
                                    <div class="response-width">
                                        <div class="response disable">Response Pending</div>
                                    </div>
                                    <div class="rating">

                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 interaction-item-content">
                                <div class="col-xs-12 col-sm-12 col-md-12 no-padding">
                                    <h3></h3>
                                    <p></p>
                                </div>

                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <a title="Respond to this review" class="btn btn-primary btn-response" target="_blank"
                                   href="{{ instagramServices.href }}">Respond <span
                                            class="icon-share"></span></a>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 review-response-form">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
{% block javascripts %}
    <script>
        $(document).ready(function () {
            $('.btn-response').on('click', function() {
                $(this).parent().parent().find('.review-response-form').fadeIn();
            });
            $('.response-close-btn').on('click', function() {
                $(this).parent().parent().parent().parent().find('.review-response-form').fadeOut();
            })
         });
    </script>
{% endblock %}